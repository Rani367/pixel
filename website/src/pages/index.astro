---
import BaseLayout from '../layouts/BaseLayout.astro';

const description = "Pixel is a free, beginner-friendly programming language for making 2D games. Simple syntax, built-in game engine, sprites, physics, and audio. No setup required - runs on Windows, Mac, Linux, and web browsers.";
const keywords = ["Pixel programming language", "Pixel game engine", "2D game programming language", "beginner game development", "learn game programming", "simple game engine", "kids coding language", "educational game programming", "free game engine", "easy game development"];
---

<BaseLayout description={description} keywords={keywords}>
  <!-- 3D Background Canvas (decorative) -->
  <canvas id="pixel-bg" class="fixed inset-0 -z-10 pointer-events-none" aria-hidden="true"></canvas>

  <!-- Hero Section -->
  <section class="py-20 md:py-32 relative">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <h1 class="text-4xl md:text-6xl font-bold tracking-tight mb-6">
        Pixel: 2D Game Development Made Simple
      </h1>
      <p class="text-xl text-zinc-600 dark:text-zinc-400 max-w-2xl mx-auto mb-10">
        A beginner-friendly programming language with a built-in game engine.
        Create games in minutes, not months.
      </p>
      <div class="flex flex-wrap justify-center gap-4 mb-16">
        <a
          href="/pixel/docs"
          class="px-6 py-3 bg-cyan-400 text-zinc-900 font-medium rounded-lg hover:bg-cyan-500 transition-colors"
        >
          Get Started
        </a>
        <a
          href="/pixel/playground"
          class="px-6 py-3 border border-zinc-300 dark:border-zinc-700 font-medium rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors"
        >
          Try Online
        </a>
      </div>

      <!-- Code Example -->
      <div id="code-zoom" class="max-w-2xl mx-auto text-left" style="transform-origin: center top; transition: transform 0.1s ease-out;">
        <div class="bg-zinc-900 rounded-lg overflow-hidden shadow-2xl">
          <div class="flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-3 bg-zinc-800">
            <span class="w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-red-500"></span>
            <span class="w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-yellow-500"></span>
            <span class="w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-green-500"></span>
            <span class="ml-2 text-xs sm:text-sm text-zinc-400">game.pixel</span>
          </div>
          <pre class="p-3 sm:p-6 text-[11px] sm:text-sm leading-relaxed overflow-x-auto"><code class="text-zinc-300"><span class="text-purple-400">function</span> <span class="text-cyan-400">on_start</span>() {'{'}
    <span class="text-cyan-400">create_window</span>(<span class="text-orange-400">800</span>, <span class="text-orange-400">600</span>, <span class="text-green-400">"My Game"</span>)
    player = <span class="text-cyan-400">create_sprite</span>(<span class="text-cyan-400">load_image</span>(<span class="text-green-400">"hero.png"</span>))
    player.x = <span class="text-orange-400">400</span>
{'}'}

<span class="text-purple-400">function</span> <span class="text-cyan-400">on_update</span>(dt) {'{'}
    <span class="text-purple-400">if</span> <span class="text-cyan-400">key_down</span>(KEY_RIGHT) {'{'}
        player.x = player.x + <span class="text-orange-400">200</span> * dt
    {'}'}
{'}'}

<span class="text-purple-400">function</span> <span class="text-cyan-400">on_draw</span>() {'{'}
    <span class="text-cyan-400">clear</span>(<span class="text-cyan-400">rgb</span>(<span class="text-orange-400">20</span>, <span class="text-orange-400">20</span>, <span class="text-orange-400">40</span>))
    <span class="text-cyan-400">draw_sprite</span>(player)
{'}'}</code></pre>
        </div>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="py-16 bg-zinc-50 dark:bg-zinc-900">
    <div class="max-w-6xl mx-auto px-4">
      <div class="grid md:grid-cols-3 gap-8">
        <div class="p-6">
          <div class="w-12 h-12 bg-[--color-accent]/10 rounded-lg flex items-center justify-center mb-4">
            <svg class="w-6 h-6 text-[--color-accent]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
            </svg>
          </div>
          <h3 class="text-lg font-semibold mb-2">Simple Syntax</h3>
          <p class="text-zinc-600 dark:text-zinc-400">
            Easy to learn syntax inspired by Python. Write readable code without boilerplate.
          </p>
        </div>

        <div class="p-6">
          <div class="w-12 h-12 bg-[--color-accent]/10 rounded-lg flex items-center justify-center mb-4">
            <svg class="w-6 h-6 text-[--color-accent]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <h3 class="text-lg font-semibold mb-2">Built-in Engine</h3>
          <p class="text-zinc-600 dark:text-zinc-400">
            Sprites, animations, physics, audio, and input handling included. No external libraries needed.
          </p>
        </div>

        <div class="p-6">
          <div class="w-12 h-12 bg-[--color-accent]/10 rounded-lg flex items-center justify-center mb-4">
            <svg class="w-6 h-6 text-[--color-accent]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
            </svg>
          </div>
          <h3 class="text-lg font-semibold mb-2">Runs Anywhere</h3>
          <p class="text-zinc-600 dark:text-zinc-400">
            Build for Windows, macOS, Linux, and the web. One codebase, multiple platforms.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Install Section -->
  <section class="py-16 bg-zinc-100 dark:bg-zinc-900 relative overflow-hidden noise-bg">
    <div class="max-w-6xl mx-auto px-4">
      <h2 class="text-2xl font-bold text-center mb-8">Quick Start</h2>
      <div class="max-w-2xl mx-auto space-y-4">
        <!-- Curl Command Block -->
        <div class="relative">
          <p class="text-sm text-zinc-500 dark:text-zinc-400 mb-2 font-medium">Install Pixel (one command)</p>
          <div class="curl-command-block bg-zinc-900 rounded-xl p-4 flex items-center gap-3">
            <div class="flex-1 min-w-0 overflow-x-auto scrollbar-hide">
              <code id="curl-command" class="text-green-400 font-mono text-xs sm:text-sm whitespace-nowrap block">curl -fsSL https://raw.githubusercontent.com/Rani367/pixel/main/scripts/install.sh | bash</code>
            </div>
            <button
              id="copy-btn"
              class="copy-button flex-shrink-0 relative w-10 h-10 rounded-lg bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 hover:border-cyan-500/50 transition-all duration-200 flex items-center justify-center group"
              aria-label="Copy to clipboard"
            >
              <!-- Copy Icon -->
              <svg id="copy-icon" class="w-5 h-5 text-zinc-400 group-hover:text-cyan-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              <!-- Checkmark Icon (hidden by default) -->
              <svg id="check-icon" class="w-5 h-5 text-green-400 absolute opacity-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
              </svg>
              <!-- 3D Burst Effect Container -->
              <div id="burst-container" class="absolute inset-0 pointer-events-none overflow-visible"></div>
            </button>
          </div>
        </div>

        <!-- Run Command Block -->
        <div class="bg-zinc-900 rounded-xl p-4">
          <div class="space-y-2 font-mono text-sm">
            <p class="text-zinc-400"># Run your first game</p>
            <p class="text-zinc-100">$ <span class="text-green-400">pixel game.pixel</span></p>
          </div>
        </div>

        <p class="text-center mt-4 text-sm text-zinc-600 dark:text-zinc-400">
          See <a href="/pixel/docs/installation" class="text-[--color-accent] hover:underline">installation guide</a> for all options.
        </p>
      </div>
    </div>
  </section>

  <!-- Three.js for 3D background -->
  <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <script is:inline>
    // Code zoom scroll effect
    const codeZoom = document.getElementById('code-zoom');

    function updateZoom() {
      if (!codeZoom) return;

      const rect = codeZoom.getBoundingClientRect();
      const viewportHeight = window.innerHeight;

      const startPoint = viewportHeight;
      const endPoint = viewportHeight * 0.3;
      const currentPoint = rect.top;

      let progress = (startPoint - currentPoint) / (startPoint - endPoint);
      progress = Math.max(0, Math.min(1, progress));

      const scale = 0.75 + (progress * 0.5);
      codeZoom.style.transform = `scale(${scale})`;
    }

    window.addEventListener('scroll', updateZoom, { passive: true });
    window.addEventListener('resize', updateZoom);
    updateZoom();

    // STUNNING 3D PARTICLE WAVE BACKGROUND
    (function() {
      const canvas = document.getElementById('pixel-bg');
      if (!canvas || typeof THREE === 'undefined') return;

      // Scene setup
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 50;
      camera.position.y = 15;

      const renderer = new THREE.WebGLRenderer({
        canvas,
        alpha: true,
        antialias: true
      });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

      // Check dark mode
      const isDark = () => document.documentElement.classList.contains('dark');

      // ============ PARTICLE GRID WAVE ============
      const GRID_SIZE = 80;
      const SPACING = 1.2;
      const particles = [];
      const particleGeometry = new THREE.SphereGeometry(0.15, 8, 8);

      // Create gradient colors: cyan -> purple -> pink
      function getGradientColor(x, z, time) {
        const normalizedX = (x + GRID_SIZE * SPACING / 2) / (GRID_SIZE * SPACING);
        const wave = Math.sin(time * 0.5 + normalizedX * Math.PI * 2) * 0.5 + 0.5;

        // Cyan to purple to pink gradient
        const r = Math.floor(lerp(0, 255, wave * 0.8));
        const g = Math.floor(lerp(212, 50, wave));
        const b = Math.floor(lerp(255, 255, 1));

        return new THREE.Color(`rgb(${r}, ${g}, ${b})`);
      }

      function lerp(a, b, t) {
        return a + (b - a) * t;
      }

      // Create particle grid
      const particleGroup = new THREE.Group();
      for (let i = 0; i < GRID_SIZE; i++) {
        for (let j = 0; j < GRID_SIZE; j++) {
          const material = new THREE.MeshBasicMaterial({
            color: 0x00d4ff,
            transparent: true,
            opacity: 0.8
          });

          const particle = new THREE.Mesh(particleGeometry, material);

          particle.position.x = (i - GRID_SIZE / 2) * SPACING;
          particle.position.z = (j - GRID_SIZE / 2) * SPACING;
          particle.position.y = 0;

          particle.userData = {
            originalX: particle.position.x,
            originalZ: particle.position.z,
            gridI: i,
            gridJ: j
          };

          particleGroup.add(particle);
          particles.push(particle);
        }
      }

      particleGroup.rotation.x = -0.5;
      particleGroup.position.y = -20;
      scene.add(particleGroup);

      // ============ MOUSE INTERACTION ============
      let mouseX = 0;
      let mouseY = 0;
      let targetMouseX = 0;
      let targetMouseY = 0;

      document.addEventListener('mousemove', (e) => {
        targetMouseX = (e.clientX / window.innerWidth - 0.5) * 2;
        targetMouseY = (e.clientY / window.innerHeight - 0.5) * 2;
      });

      // ============ ANIMATION LOOP ============
      let time = 0;

      function animate() {
        requestAnimationFrame(animate);
        time += 0.016;

        // Smooth mouse following
        mouseX += (targetMouseX - mouseX) * 0.05;
        mouseY += (targetMouseY - mouseY) * 0.05;

        // Animate particle wave
        const dark = isDark();
        particles.forEach((particle, idx) => {
          const data = particle.userData;
          const i = data.gridI;
          const j = data.gridJ;

          // Complex wave pattern
          const waveX = Math.sin(time * 0.8 + i * 0.15) * 2;
          const waveZ = Math.cos(time * 0.6 + j * 0.15) * 2;
          const waveXZ = Math.sin(time * 0.4 + (i + j) * 0.1) * 1.5;

          // Mouse influence on nearby particles
          const distToCenter = Math.sqrt(
            Math.pow(data.originalX - mouseX * 30, 2) +
            Math.pow(data.originalZ - mouseY * 20, 2)
          );
          const mouseInfluence = Math.max(0, 1 - distToCenter / 25) * 5;

          particle.position.y = waveX + waveZ + waveXZ + mouseInfluence;

          // Color based on height
          const heightNorm = (particle.position.y + 5) / 15;
          const r = Math.floor(lerp(0, 200, heightNorm));
          const g = Math.floor(lerp(212, 100, heightNorm));
          const b = 255;
          particle.material.color.setRGB(r/255, g/255, b/255);

          // Opacity based on position and theme
          const edgeFade = Math.min(
            Math.min(i, GRID_SIZE - i) / 10,
            Math.min(j, GRID_SIZE - j) / 10,
            1
          );
          particle.material.opacity = (0.4 + heightNorm * 0.4) * edgeFade * (dark ? 1 : 0.6);

          // Scale based on height (pulsing effect)
          const scale = 1 + heightNorm * 0.5;
          particle.scale.setScalar(scale);
        });

        // Camera movement
        camera.position.x += (mouseX * 8 - camera.position.x) * 0.02;
        camera.position.y += (15 - mouseY * 5 - camera.position.y) * 0.02;
        camera.lookAt(0, 0, 0);

        // Gentle auto-rotation of particle grid
        particleGroup.rotation.z = Math.sin(time * 0.1) * 0.05;

        renderer.render(scene, camera);
      }

      // Handle resize
      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      animate();
    })();
  </script>

  <!-- Copy Button 3D Animation Script -->
  <script is:inline>
    (function() {
      const copyBtn = document.getElementById('copy-btn');
      const curlCommand = document.getElementById('curl-command');
      const copyIcon = document.getElementById('copy-icon');
      const checkIcon = document.getElementById('check-icon');
      const burstContainer = document.getElementById('burst-container');

      if (!copyBtn || !curlCommand) return;

      // Create 3D particle burst effect
      function createBurstEffect() {
        const colors = ['#22d3ee', '#06b6d4', '#0891b2', '#67e8f9', '#a5f3fc', '#22c55e', '#4ade80'];
        const particleCount = 16;

        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement('div');
          particle.className = 'burst-particle';

          // Calculate angle and positions with JavaScript
          const angleRad = (i / particleCount) * Math.PI * 2;
          const distance = 35 + Math.random() * 25;
          const endX = Math.cos(angleRad) * distance;
          const endY = Math.sin(angleRad) * distance;
          const color = colors[Math.floor(Math.random() * colors.length)];
          const size = 5 + Math.random() * 5;
          const delay = Math.random() * 0.05;
          const duration = 0.5 + Math.random() * 0.2;

          particle.style.cssText = `
            position: absolute;
            width: ${size}px;
            height: ${size}px;
            background: ${color};
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: none;
            opacity: 1;
            transition: transform ${duration}s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity ${duration}s ease-out;
          `;

          burstContainer.appendChild(particle);

          // Trigger animation after a tiny delay for the initial styles to apply
          requestAnimationFrame(() => {
            setTimeout(() => {
              particle.style.transform = `translate(calc(-50% + ${endX}px), calc(-50% + ${endY}px)) scale(0)`;
              particle.style.opacity = '0';
            }, delay * 1000);
          });

          // Remove particle after animation
          setTimeout(() => particle.remove(), (delay + duration + 0.1) * 1000);
        }

      }

      // Button 3D press effect
      function animateButtonPress() {
        copyBtn.style.transform = 'scale(0.9) rotateX(10deg) translateY(2px)';

        setTimeout(() => {
          copyBtn.style.transform = 'scale(1.05) rotateX(-5deg) translateY(-2px)';

          setTimeout(() => {
            copyBtn.style.transform = '';
          }, 200);
        }, 100);
      }

      // Icon swap animation
      function swapIcons() {
        copyIcon.style.transform = 'scale(0) rotateY(180deg)';
        copyIcon.style.opacity = '0';

        setTimeout(() => {
          checkIcon.style.transform = 'scale(1.2) rotateY(0deg)';
          checkIcon.style.opacity = '1';

          setTimeout(() => {
            checkIcon.style.transform = 'scale(1)';
          }, 100);
        }, 150);

        // Revert after 2 seconds
        setTimeout(() => {
          checkIcon.style.transform = 'scale(0) rotateY(-180deg)';
          checkIcon.style.opacity = '0';

          setTimeout(() => {
            copyIcon.style.transform = '';
            copyIcon.style.opacity = '';
          }, 150);
        }, 2000);
      }

      copyBtn.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(curlCommand.textContent);

          // Trigger all animations
          animateButtonPress();
          createBurstEffect();
          swapIcons();

        } catch (err) {
          console.error('Failed to copy:', err);
        }
      });

      // Add smooth transition styles
      copyIcon.style.transition = 'transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.2s ease';
      checkIcon.style.transition = 'transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.2s ease';
      copyBtn.style.transition = 'transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), background 0.2s ease, border-color 0.2s ease';
    })();
  </script>

  <style>
    /* Add glow effect to canvas */
    #pixel-bg {
      filter: blur(0px);
    }

    /* Curl command block styles */
    .curl-command-block {
      border: 1px solid transparent;
      perspective: 1000px;
    }

    /* Copy button 3D styles */
    .copy-button {
      transform-style: preserve-3d;
      perspective: 500px;
    }

    .copy-button:hover {
      transform: translateY(-2px) rotateX(-5deg);
    }

    .copy-button:active {
      transform: scale(0.95) translateY(1px);
    }

    /* Hide scrollbar but allow scrolling */
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }

    /* Icon container perspective */
    #copy-icon, #check-icon {
      transform-style: preserve-3d;
      backface-visibility: hidden;
    }
  </style>
</BaseLayout>
