---
import BaseLayout from '../../layouts/BaseLayout.astro';
import fs from 'node:fs';
import path from 'node:path';

export function getStaticPaths() {
  return [
    { params: { slug: 'getting-started' } },
    { params: { slug: 'installation' } },
    { params: { slug: 'language/basics' } },
    { params: { slug: 'language/control-flow' } },
    { params: { slug: 'language/functions' } },
    { params: { slug: 'language/data-structures' } },
    { params: { slug: 'language/index' } },
    { params: { slug: 'api/core' } },
    { params: { slug: 'api/math' } },
    { params: { slug: 'api/engine' } },
    { params: { slug: 'api/input' } },
    { params: { slug: 'api/audio' } },
    { params: { slug: 'api/physics' } },
  ];
}

const { slug } = Astro.params;

// Read the markdown file
const docsPath = path.join(process.cwd(), '..', 'docs', `${slug}.md`);
let content = '';
let title = slug?.split('/').pop() || 'Documentation';

try {
  content = fs.readFileSync(docsPath, 'utf-8');
  // Extract title from first heading
  const titleMatch = content.match(/^#\s+(.+)$/m);
  if (titleMatch) {
    title = titleMatch[1];
  }
} catch (e) {
  content = `# Not Found\n\nThe page "${slug}" was not found.`;
}

// Simple markdown to HTML
function parseMarkdown(md: string): string {
  // First, handle tables
  let result = md.replace(/\n\|(.+)\|\n\|[-\s|]+\|\n((?:\|.+\|\n?)+)/g, (match, header, body) => {
    const headers = header.split('|').map((h: string) => h.trim()).filter((h: string) => h);
    const rows = body.trim().split('\n').map((row: string) => {
      return row.split('|').map((cell: string) => cell.trim()).filter((cell: string) => cell !== '');
    });

    let table = '<div class="overflow-x-auto my-4"><table class="w-full text-sm border-collapse">';
    table += '<thead><tr class="border-b border-zinc-300 dark:border-zinc-700">';
    headers.forEach((h: string) => {
      table += `<th class="text-left py-2 px-3 font-semibold">${h}</th>`;
    });
    table += '</tr></thead><tbody>';
    rows.forEach((row: string[]) => {
      table += '<tr class="